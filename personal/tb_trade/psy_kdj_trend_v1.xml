<?xml version="1.0" encoding="utf-8"?>
<root xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" SoftVersion="8.1.2.8" DBVersion="V2.6.2.14">
  <Funcs />
  <Tactics>
    <Tactic Code="psy_kdj_trend_v1" Name="psy三级止损加入kdj趋势确认" ShowMode="Main" FuncRetType="Void" SrcText="//------------------------------------------------------------------------&#xD;&#xA;// 简称: psy_kdj_trend_v1&#xD;&#xA;// 名称: psy三级止损加入kdj趋势确认&#xD;&#xA;// 类别: 公式应用&#xD;&#xA;// 类型: 用户应用&#xD;&#xA;// 输出: Void&#xD;&#xA;//------------------------------------------------------------------------&#xD;&#xA;Params&#xD;&#xA;	// 心理线指标统计过去12根Bar柱&#xD;&#xA;	Numeric Length(12);&#xD;&#xA;	// KDJ 三个周期&#xD;&#xA;	Numeric Length_KDJ_1(9);&#xD;&#xA;	Numeric Length_KDJ_2(3);&#xD;&#xA;	Numeric Length_KDJ_3(3);&#xD;&#xA;	// J超买线&#xD;&#xA;	Numeric J_UpBand(80);&#xD;&#xA;	// J超卖线&#xD;&#xA;	Numeric J_DnBand(20);&#xD;&#xA;	// 心理线指标上轨&#xD;&#xA;	Numeric PsyUpBand(75);&#xD;&#xA;	// 心理线指标下轨&#xD;&#xA;	Numeric PsyDnBand(25);&#xD;&#xA;	// 初级止损&#xD;&#xA;	Numeric InitialStop(20);&#xD;&#xA;	// 保本止损&#xD;&#xA;	Numeric BreakEvenStop(30);&#xD;&#xA;	// 追踪止盈&#xD;&#xA;	Numeric TrailingStop(50);&#xD;&#xA;	// 初始资金1000000&#xD;&#xA;	Numeric InitialEquity(1000000);&#xD;&#xA;	// 仓位控制&#xD;&#xA;	Numeric Prop(0.05);&#xD;&#xA;&#xD;&#xA;Vars&#xD;&#xA;	// 入场后的最高价&#xD;&#xA;	NumericSeries HigherAfterEntry(0);&#xD;&#xA;	// 入场后的最低价&#xD;&#xA;	NumericSeries LowerAfterEntry(0);&#xD;&#xA;	// 心理线统计范围内阳线数&#xD;&#xA;	NumericSeries m_PosKNum(0);&#xD;&#xA;	// 心理线指标&#xD;&#xA;	NumericSeries m_Psy(0);&#xD;&#xA;&#xD;&#xA;	// 随机未成熟指标&#xD;&#xA;	NumericSeries m_RSV(0);&#xD;&#xA;	// KDJ&#xD;&#xA;	NumericSeries m_K(0);&#xD;&#xA;	NumericSeries m_D(0);&#xD;&#xA;	NumericSeries m_J(0);&#xD;&#xA;&#xD;&#xA;	//多头行情&#xD;&#xA;	Bool bLong(False);&#xD;&#xA;	// 空头行情&#xD;&#xA;	Bool bShort(False);&#xD;&#xA;	// 止损/止盈线&#xD;&#xA;	NumericSeries StopLine(0);&#xD;&#xA;	// 保证金设置与仓位控制&#xD;&#xA;	NumericSeries TotalEquity(0);&#xD;&#xA;	NumericSeries UseMargin(0);&#xD;&#xA;	NumericSeries EntryLots(0);&#xD;&#xA;	&#xD;&#xA;&#xD;&#xA;Begin&#xD;&#xA;	TotalEquity = InitialEquity+ Abs(CurrentContracts()*Close*ContractUnit()*BigPointValue()*MarginRatio());&#xD;&#xA;     UseMargin = Close*ContractUnit*BigPointValue*MarginRatio;&#xD;&#xA;     EntryLots = IntPart(TotalEquity*Prop/UseMargin);&#xD;&#xA;      &#xD;&#xA;     // 记录入场后的最高价和最低价 &#xD;&#xA;	If(BarsSinceEntry &gt;= 1){&#xD;&#xA;		HigherAfterEntry = Max(HigherAfterEntry[1], High[1]);&#xD;&#xA;		LowerAfterEntry = Min(LowerAfterEntry[1], Low[1]);&#xD;&#xA;	}&#xD;&#xA;	&#xD;&#xA;	m_RSV = (Close - Lowest(Low, Length_KDJ_1))/(Highest(High, Length_KDJ_1) - Lowest(Low, Length_KDJ_1))*100;&#xD;&#xA;	m_K = AverageFC(m_RSV, Length_KDJ_2);&#xD;&#xA;	m_D = AverageFC(m_K, Length_KDJ_3);&#xD;&#xA;	m_J = 3*m_K - 2*m_D;&#xD;&#xA;     // 统计一定范围内的阳线数目&#xD;&#xA;	m_PosKNum = PosKCount(Open, Close, Length);&#xD;&#xA;	// 心理线指标计算公式&#xD;&#xA;	m_Psy = m_PosKNum/Length*100;&#xD;&#xA;	&#xD;&#xA;	// 统计范围内，阳线数目大于初始阈值确认上行趋势&#xD;&#xA;	bLong = m_Psy[1] &gt;= PsyUpBand &amp;&amp; m_J[1] &gt;= J_UpBand;&#xD;&#xA;	// 统计范围内，阳线数目小于初始阈值确认下行趋势&#xD;&#xA;	bShort = m_Psy[1] &lt;= PsyDnBand &amp;&amp; m_J[1] &lt;= J_DnBand;&#xD;&#xA;&#xD;&#xA;	// 趋势上行同时没有持多仓&#xD;&#xA;	If(bLong &amp;&amp; MarketPosition != 1){&#xD;&#xA;		Buy(EntryLots, Open);&#xD;&#xA;		HigherAfterEntry = Open;&#xD;&#xA;		LowerAfterEntry = Open;&#xD;&#xA;	}&#xD;&#xA;	&#xD;&#xA;	// 趋势下行同时没有持空仓&#xD;&#xA;	If(bShort &amp;&amp; MarketPosition != -1){&#xD;&#xA;		SellShort(EntryLots, Open);&#xD;&#xA;		HigherAfterEntry = Open;&#xD;&#xA;		LowerAfterEntry = Open;&#xD;&#xA;	}&#xD;&#xA;	&#xD;&#xA;	// 持有多仓，三级止损&#xD;&#xA;	If(MarketPosition == 1){&#xD;&#xA;		StopLine = EntryPrice*(1-InitialStop/1000);&#xD;&#xA;		If(HigherAfterEntry &gt;= EntryPrice*(1+BreakEvenStop/1000)){&#xD;&#xA;			StopLine = EntryPrice;&#xD;&#xA;		}&#xD;&#xA;		If(StopLine &lt; HigherAfterEntry*(1-TrailingStop/1000)){&#xD;&#xA;			StopLine = HigherAfterEntry*(1-TrailingStop/1000);&#xD;&#xA;		}&#xD;&#xA;		If(Low &lt;= StopLine  &amp;&amp; BarsSinceEntry &gt;= 1){&#xD;&#xA;			Sell(0, StopLine);&#xD;&#xA;		}&#xD;&#xA;	}&#xD;&#xA;	// 持有空仓，三级止损&#xD;&#xA;	If(MarketPosition == -1){&#xD;&#xA;		StopLine = EntryPrice*(1+InitialStop/1000);&#xD;&#xA;		If(LowerAfterEntry &lt;= EntryPrice*(1-BreakEvenStop/1000)){&#xD;&#xA;			StopLine = EntryPrice;&#xD;&#xA;		}&#xD;&#xA;		If(StopLine &gt; LowerAfterEntry*(1+TrailingStop/1000)){&#xD;&#xA;			StopLine = LowerAfterEntry*(1+TrailingStop/1000);&#xD;&#xA;		}&#xD;&#xA;		If(High &gt;= StopLine &amp;&amp; BarsSinceEntry &gt;= 1){&#xD;&#xA;			BuyToCover(0, StopLine);&#xD;&#xA;		}&#xD;&#xA;	}&#xD;&#xA;	 &#xD;&#xA;End&#xD;&#xA;&#xD;&#xA;&#xD;&#xA;//------------------------------------------------------------------------&#xD;&#xA;// 编译版本:	2017/04/12 214005&#xD;&#xA;// 内核版本:	V2.6.2.14&#xD;&#xA;// 版权所有	curiousbull&#xD;&#xA;// 更改声明	TradeBlazer Software保留对TradeBlazer平台&#xD;&#xA;//			每一版本的TradeBlazer公式修改和重写的权利&#xD;&#xA;//------------------------------------------------------------------------" IsEncry="false" md5Key="" FormulaVersion="V2.6.2.14">
      <IsSourceInfoUpdated>false</IsSourceInfoUpdated>
      <SerVarRefCount>0</SerVarRefCount>
      <IsSrcCodeEmpty>false</IsSrcCodeEmpty>
    </Tactic>
  </Tactics>
  <TacticSettings />
</root>